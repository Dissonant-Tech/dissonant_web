<!DOCTYPE html>
<html>
  <head>
    <!--  Load platform.js for polyfill support. -->
    <script src="/bower_components/platform/platform.js"></script>

    <!--  Use an HTML Import to bring in the element. -->
    <link rel="import" href="/bower_components/core-menu/core-menu.html">
    <link rel="import" href="/bower_components/core-ajax/core-ajax.html">
    <link rel="import" href="/bower_components/core-item/core-item.html">
    <link rel="import" href="/bower_components/core-icons/core-icons.html">
    <link rel="import" href="/bower_components/core-pages/core-pages.html">
    <link rel="import" href="/bower_components/core-toolbar/core-toolbar.html">
    <link rel="import" href="/bower_components/core-tooltip/core-tooltip.html">
    <link rel="import" href="/bower_components/core-header-panel/core-header-panel.html">
    <link rel="import" href="/bower_components/core-drawer-panel/core-drawer-panel.html">
    <link rel="import" href="/bower_components/core-animated-pages/core-animated-pages.html">
    <link rel="import" href="/bower_components/core-collapse/core-collapse.html">

    <!--  Import Material design elements. -->
    <link rel="import" href="/bower_components/paper-item/paper-item.html">
    <link rel="import" href="/bower_components/paper-toast/paper-toast.html">
    <link rel="import" href="/bower_components/paper-ripple/paper-ripple.html">
    <link rel="import" href="/bower_components/paper-button/paper-button.html">
    <link rel="import" href="/bower_components/paper-elements/paper-elements.html">
    <link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">

    <!--  Import custom elements. -->
    <link rel="import" href="/elements/my-post/my-post.html">
    <link rel="import" href="/elements/dissonant-post/dissonant-post.html">
    <link rel="import" href="/elements/dissonant-searchbox/dissonant-searchbox.html">
    <link rel="import" href="/elements/blog-item/blog-item.html">
    <link rel="import" href="/elements/about-page/about-page.html">
    <link rel="import" href="/elements/project-page/project-page.html">
    <link rel="import" href="/elements/contact-page/contact-page.html">

    <!-- Custom css -->
    <link href="static/css/main.css" rel="stylesheet"/>

    <style type="text/css" media="screen">
      .bg-grey {
        height: 350px;
        background: #909090;
      }
      .bg-grey-small {
        height: 50px;
        background: #f7f7f7;
      }
      #mainheader {
        color: #202020;
        font-family: "Roboto-Regular";
        font-size: 1.8rem;
      }
      .blue {
        height: 350px;
        background: #03A9F4;
      }
      .active-page {
        color: black;
      }
      #search-container {
        margin-right: 25px;
      }
      paper-item {
        text-align: center;
        padding: 30px;
        padding-top: 20px;
        padding-bottom: 20px;
        letter-spacing: .14em;
        color: black;
      }
      .blog-container {
        padding-left: 7%;
        padding-right: 7%;
      }
      .blog-header h1 {
        font-size: 2.8rem;
        margin-left: 2.8rem;
        padding-bottom: 0;
        margin-bottom: 0;
        color: #4c4d4f;
      }
      .blog-header hr {
        padding-top: 0;
        margin-top: 0;
      }
      .blog-item-container {
        width: 100%;
      }
    </style>

  </head>

  <body fullbleed unresolved>
    <core-drawer-panel responsiveWidth="1920px" id="drawerPanel">

    <core-header-panel drawer mode="seamed" class="cs-inset-box-shadow">
    <core-toolbar id="drawer-toolbar" class="cs-inset-box-shadow" style="background: #f8f8f8;">
    <core-icon src="static/images/logo.png" size="48"></core-icon>
    <span style="color: grey;">Dissonant</span>
    </core-toolbar>
    <core-menu selected="0" id="core-pages-switcher" style="margin: 0; text-align: center;"flex vertical layout>
      <paper-item label="Home"></paper-item>
      <paper-item label="Projects"></paper-item>
      <paper-item label="About"></paper-item>
      <paper-item label="Contact"></paper-item>
    </core-menu>
    </core-header-panel>

    <core-header-panel main mode="seemed">
    <core-toolbar id="mainheader">
    <paper-icon-button id="navicon" icon="menu"></paper-icon-button>
    <span id="title" flex> Dissonant-Tech </span>
    <div id="search-container">
    <dissonant-searchbox></dissonant-searchbox>
    </div>
    </core-toolbar>

    <div id="page-content" vertical layout>
      <core-animated-pages id="core-pages" selected="0" transitions="cross-fade-all">

      <div id="Home" cross-fade>
        <div id="subheader" class="bg-grey-small cs-inset-boxshadow-bottom" flex horizontal layout>
          <div id="subheader-text" style="padding-left: 3.8rem; color: #202020; opacity: .8;" center-justified>
            <h4>David Rodriguez -
              <span style="color:#d5402b"> Tech Reviews</span> |
              <span style="color:#972ff8;">Tutorials</span> |
              <span style="color:#DAA520;">Web Design</span> |
              <span style="color:#6495ED;">Programming</span> </h4>
          </div>
        </div>
        <div class="blog-container" flex vertical center-justified layout>
          <div class="blog-header" flex>
            <h1>Blog Posts </h1>
            <hr style="border-color: #fff; opacity: .8;" flex>
          </div>
          <div id="blog-list-container" style="height: 100%;" flex horizontal layout>
          <div class="blog-list" style="height:100%;" flex vertical layout>
            <paper-shadow z="1"> </paper-shadow>
            <core-ajax id="blog-ajax"></core-ajax>
            <div id="blog-item-container" flex horizontal layout center-justified>
            </div>
          </div>

          </div>
        </div>

      </div>

      <div id="Projects" style="height: 350px; background-color:#03A9F4;">
        <project-page>
        </project-page>
      </div>

      <div id="About" style="height: 350px; background-color: blueviolet;">
        <about-page>
        </about-page>
      </div>

      <div id="Contact" class="page bg-grey">
        <contact-page>
        </contact-page>
      </div>

      </core-animated-pages>
    </div>

    </core-header-panel>
    </core-drawer-panel>

  </body>

  <!-- Date.js - for date formatting -->
  <script src="static/js/date.js"></script>

  <script type="text/javascript">
    document.addEventListener('polymer-ready', function() {
      var navicon = document.getElementById('navicon');
      var drawerPanel = document.getElementById('drawerPanel');
      navicon.addEventListener('click', function() {
        drawerPanel.togglePanel();
      });
      loadBlogs();
    });

// format dates to a 'prettier' format
function formatDate(_date) {
  return Date.parse(_date).toString('d MMM yyyy');
}


// core-pages-switcher, uses nav menu to switch through different pages
var pages = document.querySelector('#core-pages');
var page_switcher = document.querySelector('#core-pages-switcher');
var pageList = page_switcher.children;

page_switcher.addEventListener('click', function(e) {
  var clicked = e.target;
  var selected = Array.prototype.indexOf.call(pageList, clicked);
  pages.selected = selected;

  updateTitle(clicked.label);
});

// Updates the toolbar title
var title = document.getElementById("title");
var baseTitle = 'Dissonant-Tech |';

function updateTitle(txt) {
  title.innerHTML = baseTitle + txt;
}

// Load blogs with ajax call
var blog_ajax = document.querySelector('#blog-ajax');
var blog_item_container = document.querySelector('#blog-item-container');

function renderBlogItems(parent_div, items) {
  var len = items.length;

  for(var i = 0; i < len; i++) {
    parent_div.appendChild(renderBlogItem(items[i]['title'], items[i]['date_publish'], items[i]['categories']));
  }
}

function renderBlogItem(title, date, categories) {
  var temp = document.createElement('div');
  temp.innerHTML = '<blog-item title= "'+title+'" pubdate="'+formatDate(date)+'" flex></blog-item>';
  return temp;
}

function loadBlogs() {
  var url = document.URL + "ajax/";

  blog_ajax.handleAs = 'json';
  blog_ajax.method = 'GET';
  blog_ajax.params = {};
  blog_ajax.url = url;
  blog_ajax.go();
}

blog_ajax.addEventListener('core-response', function(e){
  renderBlogItems(blog_item_container, this.response);
});

  </script>
</html>
